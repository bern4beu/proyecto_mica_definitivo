<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tablas.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/lightbox.css') }}">
</head>
<body>
    
    <div class="container" style="max-width: 1400px;">
        
        <div class="header-section">
            <h2>üì¶ Listado de Productos</h2>
            <div style="display: flex; gap: 10px;">
                <a href="/producto_base" class="btn btn-primary">+ Producto Base</a>
                <a href="/producto_variante" class="btn btn-primary">+ Variante</a>
            </div>
        </div>
        
        {% if productos %}
        
        <!-- Buscador -->
        <div class="search-box">
            <input type="text" 
                   id="searchInput" 
                   placeholder="Buscar por producto, marca, proveedor o ubicaci√≥n..."
                   autocomplete="off">
        </div>
        
        <!-- Filtros -->
<div class="filtros-container">
    
    <!-- Filtro por veh√≠culo -->
    <div class="filtro-vehiculo">
        <h4 style="margin: 0 0 15px 0; color: #667eea;">üöó Filtrar por Veh√≠culo</h4>
        
        <div class="filtro-vehiculo-grid">
            <div class="form-group" style="margin-bottom: 0;">
                <label for="filtroMarca">Marca:</label>
                <select id="filtroMarca">
                    <option value="">-- Todas --</option>
                </select>
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label for="filtroModelo">Modelo:</label>
                <select id="filtroModelo" disabled>
                    <option value="">-- Seleccione marca --</option>
                </select>
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label for="filtroMotor">Motor:</label>
                <select id="filtroMotor" disabled>
                    <option value="">-- Seleccione modelo --</option>
                </select>
            </div>
            
            <div style="display: flex; align-items: flex-end;">
                <button type="button" id="btnLimpiarVehiculo" class="btn-limpiar" style="width: 100%;">
                    Limpiar
                </button>
            </div>
        </div>
    </div>
    
    <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">
    
    <!-- Filtro de stock -->
    <label style="margin: 0;">
        <input type="checkbox" id="filtroStockBajo">
        Mostrar solo stock bajo (‚â§ 5)
    </label>
    
</div>
        
        <!-- Tabla de productos -->
        <div class="table-container">
            <table class="tabla-moderna" id="tablaProductos">
                <thead>
                    <tr>
                        <th>Imagen</th>
                        <th>Producto</th>
                        <th>Marca</th>
                        <th>Calidad</th>
                        <th class="text-right">Precio</th>
                        <th class="text-center">Stock</th>
                        <th>Proveedor</th>
                        <th>Ubicaci√≥n</th>
                        <th>C√≥digo</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in productos %}
                    <tr class="{% if p.stock <= 5 %}stock-bajo-row{% endif %}" data-stock="{{ p.stock }}" data-productoid="{{ p.id }}">
                        <td data-label="Imagen">
                            {% if p.imagen_url %}
                            <img src="{{ p.imagen_url }}" 
                                alt="{{ p.producto }}"
                                class="imagen-producto"
                                style="width: 60px; height: 60px; object-fit: cover; border-radius: 6px; 
                                        border: 1px solid #ddd; cursor: pointer; transition: transform 0.2s;"
                                onmouseover="this.style.transform='scale(1.1)'"
                                onmouseout="this.style.transform='scale(1)'">
                            {% else %}
                            <div style="width: 60px; height: 60px; background: #f0f0f0; border-radius: 6px; 
                                        display: flex; align-items: center; justify-content: center; color: #999; font-size: 24px;">
                                üì¶
                            </div>
                            {% endif %}
                        </td>
                        <td data-label="Producto">{{ p.producto }}</td>
                        <td data-label="Marca">{{ p.marca }}</td>
                        <td data-label="Calidad">{{ p.calidad or "-" }}</td>
                        <td data-label="Precio" class="text-right precio">${{ p.precio }}</td>
                        <td data-label="Stock" class="text-center">
                            <span class="badge-stock-simple {% if p.stock == 0 %}critico{% elif p.stock <= 2 %}muy-bajo{% elif p.stock <= 5 %}bajo{% else %}ok{% endif %}">
                                {{ p.stock }}
                            </span>
                        </td>
                        <td data-label="Proveedor">{{ p.proveedor or "-" }}</td>
                        <td data-label="Ubicaci√≥n">{{ p.ubicacion or "-" }}</td>
                        <td data-label="C√≥digo">{{ p.codigo or "-" }}</td>
                        <td data-label="Acciones">
                            <a href="/editar_variante/{{ p.id }}" class="btn-detalle">‚úèÔ∏è Editar</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div id="sinResultados" class="sin-resultados" style="display: none;">
            No se encontraron productos que coincidan con los filtros.
        </div>
        
        <!-- Resumen -->
        <div class="resumen-productos">
            <p><strong>Total de productos:</strong> <span id="totalProductos">{{ productos|length }}</span></p>
            <p><strong>Productos visibles:</strong> <span id="productosVisibles">{{ productos|length }}</span></p>
        </div>
        
        {% else %}
        
        <div class="mensaje-vacio">
            <p>üì¶ No hay productos cargados todav√≠a.</p>
            <a href="/producto_base" class="btn btn-primary">Cargar producto base</a><br><br>
            <a href="/producto_variante" class="btn btn-primary">Cargar producto variante</a>
        </div>
        
        {% endif %}
        
        <a href="/" class="btn btn-secondary">Volver al inicio</a>
    </div>
    
    <script src="{{ url_for('static', filename='js/productos.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lightbox.js') }}"></script>
    
</body>
</html>